---
title: "eConsent Training Tracking"
author: "JP Giliberto MD"
format: dashboard

---

```{r}
library(tidyverse)
library (lubridate)
library(gt)
library(scales)
library(rjson)
library(readxl)

Provider_Training_Distribution <- read_excel("Provider Training Distribution.xlsx")
filenamescon <- list.files("C:/Users/jpgil/OneDrive/Documents/R/eConsent/exports", pattern="*.xlsx", full.names=TRUE)
completed<- read_excel(filenamescon)

training_data <- Provider_Training_Distribution |> 
  left_join(completed) |> 
  mutate(Completed = !is.na(ID))


 # this should give you a character vector, with each file name represented by an entry
```
## Row - Badges {height=20%}

```{r}
#| content: valuebox
#| title: "Total Completion Rate"

total_rate <- training_data |> 
  summarise(Total_Completion_Rate = round(sum(Completed)/n(), 3))
list(icon = "bookmark-check-fill",
     color = "success",
     value = percent(pull(total_rate,1),accuracy = 0.1)
)
```

```{r} 
#| content: valuebox
#| title: "Last Updated"

Update <- training_data |> 
  summarise(last_update = format(max(`Completion time`, na.rm = T),"%m/%d")) 

numby =pull(Update,1)

list(
  icon = "calendar",
  color = "primary",
  value = numby
)

```

## Row - Completion Rates by Specialty {height = 80%}

```{r}
#|title: "Total Completion Rate by Specialty"

completion_rates <- training_data |> 
  group_by(Department) |> 
  summarise(Completed = round(sum(Completed)/n(), 3))

ggplot(completion_rates, aes(x = reorder(Department, Completed),
                             y = Completed, 
                             label = percent(Completed, accuracy = 0.1), 
                             color = Completed, 
                             fill=Completed)) +
  geom_col() +
  geom_text(nudge_y = 0.019, color = "black")+
  scale_color_continuous(type = "viridis")+
  scale_fill_continuous(type = "viridis")+
  coord_flip()+
  xlab("Specialty")+
  ylab("Percent Completed")

```
